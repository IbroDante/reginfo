<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | JODOR Asset Management</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }
        .form-container {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        table.dataTable thead th {
            background-color: #f3f4f6;
            color: #1f2937;
            font-weight: 600;
        }
        table.dataTable tbody tr:hover {
            background-color: #f9fafb;
        }
        .profile-pic {
            max-width: 50px;
            max-height: 50px;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center">
                        <svg class="h-8 w-8 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                        </svg>
                        <span class="ml-2 text-xl font-bold text-gray-800">J.A.M Ltd</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <a href="/" class="px-4 py-2 rounded-md text-sm font-medium text-gray-600 hover:text-blue-600 transition duration-150">
                        <i class="fas fa-arrow-left mr-2"></i> Back to Home
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="min-h-screen py-12 px-4 sm:px-6 lg:px-8">
        <div class="max-w-7xl mx-auto">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">Admin Dashboard</h1>
                <p class="text-gray-600">Manage registrations for the Sustainable Energy Forum (SEF-2025)</p>
            </div>

            {% if users is none %}
                <div class="max-w-md mx-auto bg-white rounded-xl form-container p-8">
                    <form method="POST" action="{{ url_for('admin') }}" class="space-y-6">
                        <div>
                            <label for="admin_password" class="block text-sm font-medium text-gray-700 mb-1">Admin Password</label>
                            <input type="password" id="admin_password" name="admin_password" required 
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200">
                        </div>
                        <div>
                            <button type="submit" 
                                class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-200">
                                Access Dashboard
                            </button>
                        </div>
                    </form>
                </div>
            {% else %}
                <div class="bg-white rounded-xl form-container p-8">
                    <table id="usersTable" class="w-full table-auto">
                        <thead>
                            <tr>
                                <th class="px-4 py-2">Title</th>
                                <th class="px-4 py-2">First Name</th>
                                <th class="px-4 py-2">Family Name</th>
                                <th class="px-4 py-2">Company/Organisation</th>
                                <th class="px-4 py-2">Country of Origin</th>
                                <th class="px-4 py-2">Email</th>
                                <th class="px-4 py-2">Telephone</th>
                                <th class="px-4 py-2">Age Group</th>
                                <th class="px-4 py-2">Qualification</th>
                                <th class="px-4 py-2">Category</th>
                                <th class="px-4 py-2">Hotel Lodging</th>
                                <th class="px-4 py-2">Travel Visa</th>
                                <th class="px-4 py-2">Further Info</th>
                                <th class="px-4 py-2">Confirmed</th>
                                <th class="px-4 py-2">Picture</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for user in users %}
                                <tr>
                                    <td class="border px-4 py-2">{{ user.title }}</td>
                                    <td class="border px-4 py-2">{{ user.first_name }}</td>
                                    <td class="border px-4 py-2">{{ user.family_name }}</td>
                                    <td class="border px-4 py-2">{{ user.company_organisation }}</td>
                                    <td class="border px-4 py-2">{{ user.country_of_origin }}</td>
                                    <td class="border px-4 py-2">{{ user.email }}</td>
                                    <td class="border px-4 py-2">{{ user.telephone }}</td>
                                    <td class="border px-4 py-2">{{ user.age_group }}</td>
                                    <td class="border px-4 py-2">{{ user.highest_qualification }}</td>
                                    <td class="border px-4 py-2">{{ user.registration_category }}</td>
                                    <td class="border px-4 py-2">{{ 'Yes' if user.hotel_lodging else 'No' }}</td>
                                    <td class="border px-4 py-2">{{ 'Yes' if user.travel_visa else 'No' }}</td>
                                    <td class="border px-4 py-2">{{ user.further_info or 'None' }}</td>
                                    <td class="border px-4 py-2">{{ 'Yes' if user.is_confirmed else 'No' }}</td>
                                    <td class="border px-4 py-2">
                                        {% if user.picture %}
                                            <img src="data:image/jpeg;base64,{{ user.picture }}" alt="Profile Picture" class="profile-pic" onclick="showImage('data:image/jpeg;base64,{{ user.picture }}')">
                                        {% else %}
                                            None
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Social Media Section -->
    <div class="bg-gray-100 py-8">
        <div class="max-w-md mx-auto px-4 text-center">
            <h3 class="text-lg font-medium text-gray-800 mb-4">Follow Us For Updates</h3>
            <p class="text-sm text-gray-600 mb-4">
                Join the conversation on our social media channels
            </p>
            <div class="flex justify-center space-x-4">
                <a href="https://www.instagram.com/jodor_a.m/" target="_blank" class="text-gray-700 hover:text-pink-600">
                    <i class="fab fa-instagram text-xl"></i>
                    <span class="sr-only">Instagram</span>
                </a>
                <a href="https://www.linkedin.com/jodor-a-m-ltd/" target="_blank" class="text-gray-700 hover:text-blue-700">
                    <i class="fab fa-linkedin text-xl"></i>
                    <span class="sr-only">LinkedIn</span>
                </a>
            </div>
        </div>
    </div>

    <!-- SweetAlert2 Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <script>
                    Swal.fire({
                        icon: '{{ 'success' if category == 'success' else 'warning' }}',
                        title: '{{ 'Success' if category == 'success' else 'Error' }}',
                        text: '{{ message }}',
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'OK'
                    });
                </script>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <!-- DataTables Initialization -->
    <script>
        $(document).ready(function() {
            $('#usersTable').DataTable({
                pageLength: 10,
                lengthMenu: [10, 25, 50, 100],
                order: [[0, 'asc']],
                columnDefs: [
                    { orderable: false, targets: 14 } // Disable sorting on Picture column
                ]
            });
        });

        function showImage(src) {
            Swal.fire({
                imageUrl: src,
                imageAlt: 'Profile Picture',
                showConfirmButton: false,
                showCloseButton: true,
                customClass: {
                    popup: 'swal2-image-popup'
                }
            });
        }
    </script>
</body>
</html>